(this["webpackJsonpgrp-explorer"]=this["webpackJsonpgrp-explorer"]||[]).push([[0],{24:function(t,e,i){},26:function(t,e,i){},38:function(t,e,i){"use strict";i.r(e);var n,s=i(7),a=i.n(s),r=i(17),o=i.n(r),h=(i(24),i(10)),l=i(5);!function(t){t[t.Init=0]="Init",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded"}(n||(n={}));var c=a.a.createContext(void 0),d=function(){return a.a.useContext(c)},u=function(t){var e=t.children,i=a.a.useState(n.Init),s=Object(h.a)(i,2),r=s[0],o=s[1];return Object(l.jsx)(c.Provider,{value:{loadingState:r,setLoadingState:o},children:e})},v=a.a.createContext(void 0),f=function(){return a.a.useContext(v)},p=function(t){var e=t.children,i=a.a.useState({name:"-none-",ext:""}),n=Object(h.a)(i,2),s=n[0],r=n[1];return Object(l.jsx)(v.Provider,{value:{file:s,setFile:r},children:e})},g=(i(26),i(0)),x=i(1),y=function(){function t(e,i,n,s){Object(g.a)(this,t),this.reader=e,this.name=i,this.size=n,this.initialOffset=s}return Object(x.a)(t,[{key:"read",value:function(){}}]),t}(),b=function(){function t(e){Object(g.a)(this,t),this.buffer=e,this.offset=0,this.view=void 0,this.view=new DataView(e)}return Object(x.a)(t,[{key:"readString",value:function(t){if(this.offset+t>this.view.byteLength)throw Error("not enough byte remaining");for(var e="",i=0;i<t;i++){var n=this.view.getUint8(this.offset+i);e+=String.fromCharCode(n)}return this.offset+=t,e}},{key:"readUint32LE",value:function(){var t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}},{key:"readUint16LE",value:function(){var t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}},{key:"readInt32LE",value:function(){var t=this.view.getInt32(this.offset,!0);return this.offset+=4,t}},{key:"readInt16LE",value:function(){var t=this.view.getInt16(this.offset,!0);return this.offset+=2,t}},{key:"readInt8",value:function(){var t=this.view.getInt8(this.offset);return this.offset+=1,t}},{key:"readUint8",value:function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t}},{key:"readBytes",value:function(t){var e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}}]),t}(),w=i(2),m=i(3),j=function(t){Object(w.a)(i,t);var e=Object(m.a)(i);function i(){var t;Object(g.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).data=void 0,t}return Object(x.a)(i,[{key:"read",value:function(){this.reader.offset=this.initialOffset,this.data=this.reader.readString(this.size)}}]),i}(y),O=function(t){Object(w.a)(i,t);var e=Object(m.a)(i);function i(){var t;Object(g.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).chars=[],t.colors=[],t}return Object(x.a)(i,[{key:"read",value:function(){if(4e3===this.size){this.reader.offset=this.initialOffset;for(var t=0;t<25;t++)for(var e=0;e<80;e++){var i=this.reader.readString(1),n=this.reader.readUint8();this.chars.push(i),this.colors.push(n)}}else console.log(this.name+" doesn't seems to be a valid b800 file.")}},{key:"print",value:function(){for(var t=0;t<25;t++){for(var e="",i=0;i<80;i++){var n=80*t+i;e+=this.chars[n]}console.log(e)}}}]),i}(y),k=function(t){Object(w.a)(i,t);var e=Object(m.a)(i);function i(){var t;Object(g.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).palette=[],t.shades=[],t}return Object(x.a)(i,[{key:"read",value:function(){this.reader.offset=this.initialOffset,"lookup.dat"===this.name?this.readLookup():"palette.dat"===this.name&&this.readPalette()}},{key:"readPalette",value:function(){for(var t=0;t<256;t++){var e={r:4*this.reader.readUint8(),g:4*this.reader.readUint8(),b:4*this.reader.readUint8(),a:255};255===t&&(e.a=0),this.palette.push(e)}for(var i=this.reader.readUint16LE(),n=0;n<i;n++){for(var s=[],a=0;a<256;a++){var r=this.reader.readUint8();s.push(this.palette[r])}this.shades.push(s)}}},{key:"readLookup",value:function(){}}]),i}(y),L=function(t){Object(w.a)(i,t);var e=Object(m.a)(i);function i(){var t;Object(g.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).tiles=[],t}return Object(x.a)(i,[{key:"read",value:function(){if(this.reader.offset=this.initialOffset,1!==this.reader.readUint32LE())throw new Error("expecting version 1 for art files");this.reader.readUint32LE();for(var t=this.reader.readUint32LE(),e=this.reader.readUint32LE()-t+1,i=0;i<e;i++)this.tiles.push({x:0,y:0,pixels:[],valid:!1});for(var n=0;n<e;n++)this.tiles[n].x=this.reader.readUint16LE();for(var s=0;s<e;s++)this.tiles[s].y=this.reader.readUint16LE();for(var a=0;a<e;a++)this.reader.readUint32LE();for(var r=0;r<e;r++){var o=this.tiles[r],h=o.x*o.y;if(h>0){for(var l=0;l<h;l++)o.pixels.push(this.reader.readUint8());o.valid=!0}}}}]),i}(y),E=function(t){Object(w.a)(i,t);var e=Object(m.a)(i);function i(){var t;Object(g.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).data=void 0,t}return Object(x.a)(i,[{key:"read",value:function(){this.reader.offset=this.initialOffset,this.data=this.reader.readBytes(this.size)}}]),i}(y),I=function(t){Object(w.a)(i,t);var e=Object(m.a)(i);function i(){var t;Object(g.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).data=void 0,t}return Object(x.a)(i,[{key:"read",value:function(){this.reader.offset=this.initialOffset,this.data=this.reader.readBytes(this.size)}}]),i}(y),z=1/1024,A=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(g.a)(this,t),this.x=e,this.y=i,this.z=n}return Object(x.a)(t,[{key:"set",value:function(t,e,i){this.x=t,this.y=e,null!=i&&(this.z=i)}}]),t}(),F=function(){function t(e,i,n){Object(g.a)(this,t),this.canvas=e,this.map=i,this.processor=n,this.context=void 0,this.boundsMin=void 0,this.boundsMax=void 0,this.lineWidth=1,this.scale=1,this.position=new A,this.initialized=!1,this.isDown=!1,this.mouseDownPosition=new A,this.worldDownPosition=new A}return Object(x.a)(t,[{key:"initialize",value:function(){var t=this;if(!this.initialized){this.initialized=!0,this.context=this.canvas.getContext("2d"),this.boundsMin=new A(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.boundsMax=new A(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),this.map.walls.forEach((function(e){t.boundsMin.x=Math.min(t.boundsMin.x,e.x),t.boundsMin.y=Math.min(t.boundsMin.y,e.y),t.boundsMax.x=Math.max(t.boundsMax.x,e.x),t.boundsMax.y=Math.max(t.boundsMax.y,e.y)}));var e=this.boundsMax.x-this.boundsMin.x;this.scale=1e3/e,this.position.set(this.map.startX,this.map.startY),this.canvas.addEventListener("mousedown",(function(e){return t.onMouseDown(e)})),this.canvas.addEventListener("mouseup",(function(e){return t.onMouseUp(e)})),this.canvas.addEventListener("mousemove",(function(e){return t.onMouseMove(e)})),this.canvas.addEventListener("wheel",(function(e){return t.onMouseWheel(e)}))}}},{key:"render",value:function(t){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#f2f6fc",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(this.canvas.width/2,this.canvas.height/2),this.context.translate(-this.position.x*this.scale,-this.position.y*this.scale),this.context.scale(this.scale,this.scale),this.renderWalls(),this.renderPlayer()}},{key:"renderWalls",value:function(){this.context.lineWidth=this.lineWidth/this.scale,this.context.strokeStyle="#06005c",this.context.beginPath();for(var t=0;t<this.map.walls.length;t++){var e=this.map.walls[t],i=this.map.walls[e.point2];this.context.moveTo(e.x,e.y),this.context.lineTo(i.x,i.y)}this.context.stroke()}},{key:"renderPlayer",value:function(){this.context.fillStyle="#e800c1",this.context.beginPath(),this.context.arc(this.map.startX,this.map.startY,1,0,2*Math.PI),this.context.fill()}},{key:"onMouseWheel",value:function(t){t.deltaY<0?this.scale*=1.2:t.deltaY>0&&(this.scale*=.8)}},{key:"onMouseDown",value:function(t){this.isDown=!0,this.mouseDownPosition.set(t.x,t.y),this.worldDownPosition.set(this.position.x,this.position.y)}},{key:"onMouseUp",value:function(t){this.isDown=!1}},{key:"onMouseMove",value:function(t){if(this.isDown){var e=t.x-this.mouseDownPosition.x,i=t.y-this.mouseDownPosition.y;this.position.set(this.worldDownPosition.x,this.worldDownPosition.y),this.position.x-=e/this.scale,this.position.y-=i/this.scale}}}]),t}(),M=function(t){Object(w.a)(i,t);var e=Object(m.a)(i);function i(){var t;Object(g.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).rawData=void 0,t.map=void 0,t.globalScale=z,t}return Object(x.a)(i,[{key:"read",value:function(){this.reader.offset=this.initialOffset,this.rawData=this.reader.readBytes(this.size)}},{key:"loadFull",value:function(){var t=new b(this.rawData);if(7!==t.readUint32LE())throw new Error("expecting map version to be 7");this.map=new T,this.map.startX=t.readInt32LE()*this.globalScale,this.map.startY=t.readInt32LE()*this.globalScale,this.map.startZ=-(t.readInt32LE()>>4)*this.globalScale,this.map.startAngle=t.readInt16LE(),this.map.currentSector=t.readInt16LE();for(var e=t.readUint16LE(),i=0;i<e;i++){var n=new N;this.map.sectors.push(n),n.index=i,n.wallptr=t.readInt16LE(),n.wallnum=t.readInt16LE(),n.ceilingz=-(t.readInt32LE()>>4)*this.globalScale,n.floorz=-(t.readInt32LE()>>4)*this.globalScale,n.ceilingstat=t.readInt16LE(),n.floorstat=t.readInt16LE(),n.ceilingpicnum=t.readInt16LE(),n.ceilingheinum=-t.readInt16LE(),n.ceilingshade=t.readInt8(),n.ceilingpal=t.readUint8(),n.ceilingxpanning=t.readUint8(),n.ceilingypanning=t.readUint8(),n.floorpicnum=t.readInt16LE(),n.floorheinum=-t.readInt16LE(),n.floorshade=t.readInt8(),n.floorpal=t.readUint8(),n.floorxpanning=t.readUint8(),n.floorypanning=t.readUint8(),n.visibility=t.readUint8(),n.filler=t.readUint8(),n.lotag=t.readInt16LE(),n.hitag=t.readInt16LE(),n.extra=t.readInt16LE(),n.fstat=new D,n.cstat=new D,S(n.cstat,n.ceilingstat),S(n.fstat,n.floorstat)}for(var s=t.readUint16LE(),a=0;a<s;a++){var r=new C;this.map.walls.push(r),r.x=t.readInt32LE()*this.globalScale,r.y=t.readInt32LE()*this.globalScale,r.point2=t.readInt16LE(),r.nextwall=t.readInt16LE(),r.nextsector=t.readInt16LE(),r.cstat=t.readInt16LE(),r.picnum=t.readInt16LE(),r.overpicnum=t.readInt16LE(),r.shade=t.readInt8(),r.pal=t.readUint8(),r.xrepeat=t.readUint8(),r.yrepeat=t.readUint8(),r.xpanning=t.readUint8(),r.ypanning=t.readUint8(),r.lotag=t.readInt16LE(),r.hitag=t.readInt16LE(),r.extra=t.readInt16LE(),r.index=a,r.stat=new P,S(r.stat,r.cstat)}for(var o=t.readUint16LE(),h=0;h<o;h++){var l=new W;this.map.sprites.push(l),l.x=t.readInt32LE(),l.y=t.readInt32LE(),l.z=t.readInt32LE(),l.cstat=t.readInt16LE(),l.picnum=t.readInt16LE(),l.shade=t.readInt8(),l.pal=t.readUint8(),l.clipdist=t.readUint8(),l.filler=t.readUint8(),l.xrepeat=t.readUint8(),l.yrepeat=t.readUint8(),l.xoffset=t.readInt8(),l.yoffset=t.readInt8(),l.sectnum=t.readInt16LE(),l.statnum=t.readInt16LE(),l.ang=t.readInt16LE(),l.owner=t.readInt16LE(),l.xvel=t.readInt16LE(),l.yvel=t.readInt16LE(),l.zvel=t.readInt16LE(),l.lotag=t.readInt16LE(),l.hitag=t.readInt16LE(),l.extra=t.readInt16LE()}for(var c=0;c<this.map.sectors.length;c++){var d=this.map.sectors[c];d.z.push(d.ceilingz),d.z.push(d.floorz);for(var u=this.map.walls[d.wallptr],v=this.map.walls[u.point2],f=0;f<2;f++){var p=0===f?d.cstat.sloped:d.fstat.sloped,g=0===f?d.ceilingheinum:d.floorheinum;if(p){g/=4096;var x=v.y-u.y,y=u.x-v.x,w=x*x+y*y;if(!(w>0)){d.grad.push(new A(0,0));break}x*=w=1/Math.sqrt(w),y*=w,d.grad.push(new A(x*g,y*g))}else d.grad.push(new A(0,0))}}}}]),i}(y);function S(t,e){for(var i=Object.keys(t),n=0;n<i.length;n++){var s=e>>n;s&=1,t[i[n]]=0!==s}}var U,T=function t(){Object(g.a)(this,t),this.startX=void 0,this.startY=void 0,this.startZ=void 0,this.startAngle=void 0,this.currentSector=void 0,this.sectors=[],this.walls=[],this.sprites=[]},N=function t(){Object(g.a)(this,t),this.wallptr=void 0,this.wallnum=void 0,this.ceilingz=void 0,this.floorz=void 0,this.ceilingstat=void 0,this.floorstat=void 0,this.ceilingpicnum=void 0,this.ceilingheinum=void 0,this.ceilingshade=void 0,this.ceilingpal=void 0,this.ceilingxpanning=void 0,this.ceilingypanning=void 0,this.floorpicnum=void 0,this.floorheinum=void 0,this.floorshade=void 0,this.floorpal=void 0,this.floorxpanning=void 0,this.floorypanning=void 0,this.visibility=void 0,this.filler=void 0,this.lotag=void 0,this.hitag=void 0,this.extra=void 0,this.cstat=void 0,this.fstat=void 0,this.index=void 0,this.walls=[],this.z=[],this.grad=[]},D=function t(){Object(g.a)(this,t),this.paralaxing=!1,this.sloped=!1,this.swapxy=!1,this.dblsmooshiness=!1,this.xflip=!1,this.yflip=!1,this.alignTexToFirstWall=!1},C=function t(){Object(g.a)(this,t),this.x=void 0,this.y=void 0,this.point2=void 0,this.nextwall=void 0,this.nextsector=void 0,this.cstat=void 0,this.picnum=void 0,this.overpicnum=void 0,this.shade=void 0,this.pal=void 0,this.xrepeat=void 0,this.yrepeat=void 0,this.xpanning=void 0,this.ypanning=void 0,this.lotag=void 0,this.hitag=void 0,this.extra=void 0,this.index=void 0,this.stat=void 0},P=function t(){Object(g.a)(this,t),this.blocking=!1,this.bottomsOfInvisibleSwapped=!1,this.alignPictureOnBottom=!1,this.xflip=!1,this.masking=!1,this.oneWay=!1,this.blockingWall2=!1,this.transluscence=!1,this.yflip=!1,this.transluscenceReversing=!1},W=function t(){Object(g.a)(this,t),this.x=void 0,this.y=void 0,this.z=void 0,this.cstat=void 0,this.picnum=void 0,this.shade=void 0,this.pal=void 0,this.clipdist=void 0,this.filler=void 0,this.xrepeat=void 0,this.yrepeat=void 0,this.xoffset=void 0,this.yoffset=void 0,this.sectnum=void 0,this.statnum=void 0,this.ang=void 0,this.owner=void 0,this.xvel=void 0,this.yvel=void 0,this.zvel=void 0,this.lotag=void 0,this.hitag=void 0,this.extra=void 0},R=i(6),Y=function(){function t(e,i,n){Object(g.a)(this,t),this.tile=e,this.palette=i,this.index=n,this.texture=void 0}return Object(x.a)(t,[{key:"getTexture",value:function(t,e){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(null==this.texture){for(var s=new Uint8ClampedArray(4*this.tile.pixels.length),a=0,r=0;r<this.tile.y;r++)for(var o=0;o<this.tile.x;o++){var h=this.tile.pixels[r+o*this.tile.y],l=this.palette.palette[h];s[4*a+0]=l.r,s[4*a+1]=l.g,s[4*a+2]=l.b,s[4*a+3]=l.a,a++}this.texture=new R.d(s,this.tile.x,this.tile.y,R.r),this.texture.wrapS=R.s,this.texture.wrapT=R.s}var c=Math.max(this.tile.x,this.tile.y),d=this.texture.clone(),u=t*(i?-1:1),v=e*(n?1:-1);return d.repeat.set(8*u/c,8*v/c),d.needsUpdate=!0,d}}]),t}(),Z=function(){function t(){Object(g.a)(this,t),this.files=[],this.palette=void 0,this.fileByName=void 0,this.allTexture=[]}return Object(x.a)(t,[{key:"read",value:function(t){var e=t.byteLength;console.log("File length: "+e);var i=new b(t),n=i.readString(12);if("KenSilverman"!==n)throw new Error("Wrong grp signature. Found : "+n);this.fileByName=new Map;var s=i.readUint32LE(),a=i.offset;a+=16*s;for(var r=0;r<s;r++){var o=i.readString(12),h=i.readUint32LE(),l=(o=o.toLowerCase()).indexOf("."),c=o.substr(l+1,3);o=o.substr(0,l+4);var d=void 0;"con"===c?(d=new j(i,o,h,a),this.files.push(d)):"bin"===c?(d=new O(i,o,h,a),this.files.push(d)):"dat"===c?(d=new k(i,o,h,a),this.files.push(d),"palette.dat"===o&&(this.palette=d)):"art"===c?(d=new L(i,o,h,a),this.files.push(d)):"voc"===c?(d=new E(i,o,h,a),this.files.push(d)):"mid"===c?(d=new I(i,o,h,a),this.files.push(d)):"map"===c?(d=new M(i,o,h,a),this.files.push(d)):(d=new y(i,o,h,a),console.log(o+", "+h)),a+=h}for(var u=0;u<this.files.length;u++){var v=this.files[u];v.read(),this.fileByName.set(v.name,v)}for(var f=0,p=this.getFiles("art"),g=0;g<p.length;g++)for(var x=p[g].tiles,w=0;w<x.length;w++){var m=x[w];this.allTexture.push(new Y(m,this.palette,f)),f++}}},{key:"addMap",value:function(t,e){var i=new b(t),n=new M(i,e,t.byteLength,0);n.read(),this.files.push(n),this.fileByName.set(n.name,n)}},{key:"getFiles",value:function(t){var e=[];return this.files.forEach((function(i){("con"===t&&i instanceof j||"bin"===t&&i instanceof O||"dat"===t&&i instanceof k||"art"===t&&i instanceof L||"voc"===t&&i instanceof E||"mid"===t&&i instanceof I||"map"===t&&i instanceof M)&&e.push(i)})),e}},{key:"getFile",value:function(t){return this.fileByName.get(t)}},{key:"getTexture",value:function(t){return t>=this.allTexture.length?(console.error("texture not found #"+t),null):this.allTexture[t]}}]),t}();function B(){return U}var X=i(18),V=i.n(X);function G(t){var e=t.tile,i=Object(s.useRef)(null);return Object(s.useEffect)((function(){if(e.valid){for(var t=B(),n=new Uint8ClampedArray(4*e.pixels.length),s=0,a=0;a<e.y;a++)for(var r=0;r<e.x;r++){var o=e.pixels[a+r*e.y],h=t.palette.palette[o];n[4*s+0]=h.r,n[4*s+1]=h.g,n[4*s+2]=h.b,n[4*s+3]=h.a,s++}var l=new ImageData(n,e.x),c=i.current;c.width=e.x,c.height=e.y,c.getContext("2d").putImageData(l,0,0)}})),e.valid?Object(l.jsx)("div",{children:Object(l.jsx)("canvas",{className:"tile",ref:i})}):Object(l.jsx)("div",{})}function K(){var t=f().file,e=B().getFile(t.name);return Object(l.jsx)("div",{className:"content",children:e.tiles.map((function(t,e){return Object(l.jsx)(G,{tile:t},e)}))})}var _=["#000000","#0000AA","#00AA00","#00AAAA","#AA0000","#AA00AA","#AA5500","#AAAAAA","#555555","#5555FF","#55FF55","#55FFFF","#FF5555","#FF55FF","#FFFF55","#FFFFFF"];function Q(t,e,i){var n="#000000",s="#FFFFFF",a=15&i,r=(240&i)>>4;return a<16&&(n=_[a]),r<16&&(s=_[r]),Object(l.jsx)("span",{style:{color:n,backgroundColor:s},children:e},t)}function q(){var t=f().file,e=B().getFile(t.name);if(2e3!=e.chars.length)return Object(l.jsx)("div",{children:"File is not 2000 char long"});for(var i=[],n=0;n<25;n++){for(var s=[],a=0;a<80;a++){var r=80*n+a,o=Q(r,e.chars[r],e.colors[r]);s.push(o)}var h=Object(l.jsx)("div",{className:"line",children:s});i.push(h)}return Object(l.jsx)("div",{className:"content",children:Object(l.jsx)("div",{className:"B800",children:i})})}function J(){var t=f().file,e=B().getFile(t.name);return Object(l.jsx)("div",{className:"content",children:Object(l.jsx)("code",{style:{whiteSpace:"pre"},children:e.data})})}function H(t){var e=t.data,i=t.type,n=t.name,a=Object(s.useRef)();return Object(s.useEffect)((function(){var t=new Blob([e],{type:i});a.current.href=window.URL.createObjectURL(t),a.current.download=n})),Object(l.jsx)("a",{ref:a,children:"Download"})}function $(){var t=f().file,e=B().getFile(t.name);return Object(l.jsxs)("div",{className:"content",children:[Object(l.jsx)("div",{children:e.name}),Object(l.jsx)(H,{type:"audio/voc",name:e.name,data:e.data})]})}function tt(){var t,e=f().file,i=B().getFile(e.name),n=!1;return Object(l.jsxs)("div",{className:"content",children:[Object(l.jsx)("div",{children:i.name}),Object(l.jsx)("div",{children:Object(l.jsx)(H,{type:"audio/mid",name:i.name,data:i.data})}),Object(l.jsx)("div",{onClick:function(){n?(t.stopMIDI(),n=!1):((t=new V.a).loadMIDI(i.data),t.playMIDI(),n=!0)},children:"Play/Pause"})]})}var et=i(19),it=new R.z,nt=new R.z,st=new R.z,at=new R.z,rt=new R.z,ot=new R.z,ht=new R.y,lt=new R.y,ct=new R.y,dt=new R.y,ut=function(){function t(e,i,n){Object(g.a)(this,t),this.canvas=e,this.map=i,this.processor=n,this.camera=void 0,this.scene=void 0,this.renderer=void 0,this.useTexture=!1,this.defaultWallMaterial=void 0,this.defaultFloorMaterial=void 0,this.defaultCeilMaterial=void 0,this.orbitControls=void 0,this.root=new R.o,this.lines=[],this.initialized=!1,this.keydowns={left:!1,right:!1,up:!1,down:!1}}return Object(x.a)(t,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.useTexture=e,this.initialized)this.lines=[],this.root.clear();else{this.initialized=!0,this.camera=new R.p(45,this.canvas.width/this.canvas.height,1,1e5),this.camera.position.set(100,200,300),this.scene=new R.t,this.scene.background=new R.c(1381653),this.scene.add(this.root),this.root.updateMatrixWorld(),this.renderer=new R.A({antialias:!0,canvas:this.canvas}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.canvas.width,this.canvas.height),this.orbitControls=new et.a(this.camera,this.canvas);var i=new R.a(16777215,.7);this.scene.add(i);var n=new R.e(16777215,1);n.position.set(.1,1,.2),this.scene.add(n);var s=.8;this.defaultWallMaterial=new R.n({color:16514816,transparent:!0,opacity:s}),this.defaultFloorMaterial=new R.n({color:16514816,transparent:!0,opacity:s}),this.defaultCeilMaterial=new R.n({color:16514816,transparent:!0,opacity:s}),document.addEventListener("keydown",(function(e){return t.onKeyDown(e)})),document.addEventListener("keyup",(function(e){return t.onKeyUp(e)})),this.renderPlayer()}this.renderWalls()}},{key:"render",value:function(t){var e=0,i=0;if(this.keydowns.up&&(e=1),this.keydowns.down&&(e=-1),this.keydowns.left&&(i=1),this.keydowns.right&&(i=-1),0!=e){var n=this.camera.getWorldDirection(it);n.multiplyScalar(e*t*5),this.camera.position.add(n),this.orbitControls.target.add(n)}if(0!=i){var s=this.camera.getWorldDirection(it),a=nt.set(0,1,0).transformDirection(this.camera.matrixWorld),r=st.copy(this.orbitControls.target).sub(this.camera.position).length();s.applyAxisAngle(a,i*t*2),s.multiplyScalar(r),this.orbitControls.target.copy(this.camera.position).add(s),this.orbitControls.update()}this.renderer.render(this.scene,this.camera)}},{key:"resize",value:function(t,e){this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)}},{key:"switchTexturing",value:function(){this.initialize(!this.useTexture)}},{key:"renderWalls",value:function(){for(var t=0;t<this.map.sectors.length;t++){for(var e=this.map.sectors[t],i=0;i<e.wallnum;i++){var n=this.map.walls[e.wallptr+i],s=this.map.walls[n.point2];this.renderWall(e,n,s)}e.floorz!=e.ceilingz&&this.renderFloorAndCeiling(e)}if(!this.useTexture){var a=[];this.lines.forEach((function(t){a.push(t.x),a.push(t.y),a.push(t.z)}));var r=new R.b;r.setAttribute("position",new R.g(a,3));var o=new R.i(r,new R.h({color:0}));this.root.add(o)}}},{key:"getWallMaterial",value:function(t){if(!this.useTexture)return this.defaultWallMaterial;var e=this.processor.getTexture(t.picnum).getTexture(t.xrepeat,t.yrepeat,t.xpanning,t.ypanning,t.stat.xflip,t.stat.yflip);return new R.m({map:e,transparent:!0})}},{key:"getCeilingMaterial",value:function(t){if(!this.useTexture)return this.defaultCeilMaterial;var e=this.processor.getTexture(t.ceilingpicnum).getTexture(16,16,t.ceilingxpanning,t.ceilingypanning,t.cstat.xflip,t.cstat.yflip);return new R.m({map:e,transparent:!0})}},{key:"getFloorMaterial",value:function(t){if(!this.useTexture)return this.defaultFloorMaterial;var e=this.processor.getTexture(t.floorpicnum).getTexture(16,16,t.floorxpanning,t.floorypanning,t.fstat.xflip,t.fstat.yflip);return new R.m({map:e,transparent:!0})}},{key:"renderWall",value:function(t,e,i){var n=-1!=e.nextsector?this.map.sectors[e.nextsector]:null;if(t.floorz!=t.ceilingz)if(null==n){it.set(e.x,this.getSlopeZ(t,1,e.x,e.y),e.y),nt.set(e.x,this.getSlopeZ(t,0,e.x,e.y),e.y),st.set(i.x,this.getSlopeZ(t,0,i.x,i.y),i.y),at.set(i.x,this.getSlopeZ(t,1,i.x,i.y),i.y);var s=this.newQuad(it,nt,st,at),a=new R.l(s,this.getWallMaterial(e));this.root.add(a)}else{if(t.floorz<n.floorz){it.set(e.x,this.getSlopeZ(t,1,e.x,e.y),e.y),nt.set(e.x,this.getSlopeZ(n,1,e.x,e.y),e.y),st.set(i.x,this.getSlopeZ(n,1,i.x,i.y),i.y),at.set(i.x,this.getSlopeZ(t,1,i.x,i.y),i.y);var r=this.newQuad(it,nt,st,at),o=new R.l(r,this.getWallMaterial(e));this.root.add(o)}if(t.ceilingz>n.ceilingz){it.set(e.x,this.getSlopeZ(n,0,e.x,e.y),e.y),nt.set(e.x,this.getSlopeZ(t,0,e.x,e.y),e.y),st.set(i.x,this.getSlopeZ(t,0,i.x,i.y),i.y),at.set(i.x,this.getSlopeZ(n,0,i.x,i.y),i.y);var h=this.newQuad(it,nt,st,at),l=new R.l(h,this.getWallMaterial(e));this.root.add(l)}}}},{key:"renderPlayer",value:function(){var t=this.map.sectors[this.map.currentSector];it.set(this.map.startX,t.floorz+1,this.map.startY);var e=270-360*R.k.inverseLerp(0,2048,this.map.startAngle);nt.set(0,0,-5).applyAxisAngle(st.set(0,1,0),e*R.k.DEG2RAD),this.camera.position.copy(it),this.orbitControls.target.copy(it).add(nt),this.orbitControls.saveState(),this.orbitControls.update(),window._orbit=this.orbitControls}},{key:"renderFloorAndCeiling",value:function(t){var e=t.wallptr,i=new R.u,n=this.map.walls[e];i.moveTo(n.x,n.y);for(var s=0;s<t.wallnum;s++){e=this.map.walls[e].point2;var a=this.map.walls[e];i.lineTo(a.x,a.y)}for(var r=new R.v(i),o=r.getAttribute("uv"),h=ht.set(o.getX(0),o.getY(0)),l=lt.set(o.getX(1),o.getY(1)),c=-ct.copy(l).sub(h).normalize().angle(),d=Math.sin(c),u=Math.cos(c),v=0;v<o.count;v++){dt.set(o.getX(v),o.getY(v)),dt.sub(h);var f=dt.x*u-dt.y*d,p=dt.x*d+dt.y*u;o.setX(v,f),o.setY(v,p)}for(var g=r.clone(),x=r.getAttribute("position"),y=0;y<x.count;y++){var b=x.getX(y),w=x.getY(y),m=this.getSlopeZ(t,0,b,w);x.setY(y,m),x.setZ(y,w)}for(var j=g.getAttribute("position"),O=0;O<j.count;O++){var k=j.getX(O),L=j.getY(O),E=this.getSlopeZ(t,1,k,L);j.setY(O,E),j.setZ(O,L)}for(var I=g.index,z=0;z<I.count;z+=3){var A=I.getY(z),F=I.getZ(z);I.setY(z,F),I.setZ(z,A)}var M=new R.l(g,this.getFloorMaterial(t)),S=new R.l(r,this.getCeilingMaterial(t));this.root.add(M),this.root.add(S)}},{key:"newQuad",value:function(t,e,i,n){var s=new R.b,a=[],r=[],o=[],h=[],l=rt.copy(e).sub(t),c=ot.copy(n).sub(t),d=(new R.z).crossVectors(l,c).normalize();r.push(t.x,t.y,t.z),r.push(e.x,e.y,e.z),r.push(i.x,i.y,i.z),r.push(n.x,n.y,n.z);var u=l.length(),v=rt.copy(n).sub(i).length();return o.push(0,0),o.push(0,0+u),o.push(1,0+v),o.push(1,0),h.push(d.x,d.y,d.z),h.push(d.x,d.y,d.z),h.push(d.x,d.y,d.z),h.push(d.x,d.y,d.z),a.push(0,3,1),a.push(1,3,2),s.setIndex(a),s.setAttribute("position",new R.g(r,3)),s.setAttribute("normal",new R.g(h,3)),s.setAttribute("uv",new R.g(o,2)),this.useTexture||(this.lines.push(t.clone()),this.lines.push(e.clone()),this.lines.push(e.clone()),this.lines.push(i.clone()),this.lines.push(i.clone()),this.lines.push(n.clone()),this.lines.push(n.clone()),this.lines.push(t.clone())),s}},{key:"getSlopeZ",value:function(t,e,i,n){var s=this.map.walls[t.wallptr];return(s.x-i)*t.grad[e].x+(s.y-n)*t.grad[e].y+t.z[e]}},{key:"onKeyDown",value:function(t){"ArrowUp"==t.key&&(this.keydowns.up=!0),"ArrowDown"==t.key&&(this.keydowns.down=!0),"ArrowLeft"==t.key&&(this.keydowns.left=!0),"ArrowRight"==t.key&&(this.keydowns.right=!0)}},{key:"onKeyUp",value:function(t){"ArrowUp"==t.key&&(this.keydowns.up=!1),"ArrowDown"==t.key&&(this.keydowns.down=!1),"ArrowLeft"==t.key&&(this.keydowns.left=!1),"ArrowRight"==t.key&&(this.keydowns.right=!1)}}]),t}(),vt=function(){function t(){Object(g.a)(this,t),this.destroyed=!1,this.root=void 0,this.canvas=[],this.resizeObserver=void 0,this.renderer2d=void 0,this.renderer3d=void 0,this.canvas2dActive=!0,this.oldTime=0}return Object(x.a)(t,[{key:"destroy",value:function(){this.destroyed=!0,this.resizeObserver.unobserve(this.root)}},{key:"initialize",value:function(t,e,i){var n=this;this.root=t;var s=t.getElementsByTagName("canvas"),a=s.item(0),r=s.item(1);this.canvas.push(a),this.canvas.push(r),this.onresize(),this.resizeObserver=new ResizeObserver((function(t){n.onresize()})),this.resizeObserver.observe(this.root),this.setCanvas2dVisible(!1),this.renderer2d=new F(r,e,i),this.renderer3d=new ut(a,e,i),this.renderer3d.initialize(),this.oldTime=ft(),this.render()}},{key:"onresize",value:function(){var t=this.root.getBoundingClientRect();this.resizeCanvas(this.canvas[0],t.width,t.height),this.resizeCanvas(this.canvas[1],t.width,t.height),null!=this.renderer3d&&this.renderer3d.resize(t.width,t.height)}},{key:"resizeCanvas",value:function(t,e,i){t.width=e*devicePixelRatio,t.height=i*devicePixelRatio,t.style.width=e+"px",t.style.height=i+"px"}},{key:"render",value:function(){var t=this;if(!this.destroyed){requestAnimationFrame((function(){return t.render()}));var e=ft(),i=e-this.oldTime;this.oldTime=e,null!=this.renderer2d&&this.canvas2dActive&&this.renderer2d.render(i/1e3),null==this.renderer3d||this.canvas2dActive||this.renderer3d.render(i/1e3)}}},{key:"setCanvas2dVisible",value:function(t){t!=this.canvas2dActive&&(this.canvas2dActive=t,this.canvas[0].style.display=t?"none":"block",this.canvas[1].style.display=t?"block":"none")}},{key:"switch2d3d",value:function(){this.canvas2dActive?this.renderer3d.initialize():this.renderer2d.initialize(),this.setCanvas2dVisible(!this.canvas2dActive)}},{key:"switchTexturing",value:function(){null!=this.renderer3d&&this.renderer3d.switchTexturing()}}]),t}();function ft(){return("undefined"===typeof performance?Date:performance).now()}function pt(){var t,e=f().file,i=B(),n=i.getFile(e.name),a=Object(s.useRef)(),r=Object(s.useRef)(),o=Object(s.useRef)(),h=!1,c=!1;return Object(s.useLayoutEffect)((function(){return console.log("LOAD  MAP"),n.loadFull(),(t=new vt).initialize(a.current,n.map,i),function(){console.log("CLEANUP MAP"),t.destroy()}})),Object(l.jsx)("div",{ref:a,className:"content",children:Object(l.jsxs)("div",{className:"map",children:[Object(l.jsxs)("div",{className:"mapheader",children:[Object(l.jsxs)("div",{className:"title",children:[n.name,"[",n.size/1e3," kB]"]}),Object(l.jsx)("div",{children:Object(l.jsx)(H,{type:"file/map",name:n.name,data:n.rawData})}),Object(l.jsx)("div",{ref:o,className:"texturing",onClick:function(){return function(){t.switchTexturing();var e=(c=!c)?"[Disable texture]":"[Enable texture]";o.current.innerText=e}()},children:"[Enable texture]"}),Object(l.jsx)("div",{ref:r,className:"view2d3d",onClick:function(){return function(){var e=(h=!h)?"[3D view]":"[2D view]";r.current.innerText=e,o.current.style.display=h?"none":"block",t.switch2d3d()}()},children:"[2D view]"})]}),Object(l.jsx)("canvas",{id:"c3d"}),Object(l.jsx)("canvas",{id:"c2d"})]})})}function gt(){var t=f().file;return""===t.name||"-none-"===t.name?Object(l.jsx)("div",{className:"content",children:"-- Select file"}):"art"===t.ext?Object(l.jsx)(K,{}):"bin"===t.ext?Object(l.jsx)(q,{}):"con"===t.ext?Object(l.jsx)(J,{}):"mid"===t.ext?Object(l.jsx)(tt,{}):"voc"===t.ext?Object(l.jsx)($,{}):"map"===t.ext?Object(l.jsx)(pt,{}):Object(l.jsx)("div",{className:"content",children:t.name})}function xt(){var t=d(),e=t.loadingState,i=t.setLoadingState;function s(t){t.preventDefault(),t.stopPropagation()}function a(t){i(n.Loading);for(var e=0;e<t.length;e++){var s=t.item(e);console.log("received : "+s.name),s.arrayBuffer().then((function(t){i(n.Loaded)}));break}}return e===n.Loading?Object(l.jsx)("div",{className:"dropzone",children:"Loading..."}):Object(l.jsx)("div",{className:"dropzone drop-area",onDragEnter:function(t){return function(t){s(t),t.currentTarget.classList.add("highlight")}(t)},onDragOver:function(t){return function(t){s(t),t.currentTarget.classList.add("highlight")}(t)},onDragLeave:function(t){return function(t){s(t),t.currentTarget.classList.remove("highlight")}(t)},onDrop:function(t){return function(t){s(t),t.currentTarget.classList.remove("highlight"),a(t.dataTransfer.files)}(t)},children:Object(l.jsxs)("form",{children:[Object(l.jsx)("p",{children:"Upload GRP file with the file dialog or by dragging and dropping onto the dashed region"}),Object(l.jsx)("input",{type:"file",id:"fileElem",accept:"*/*",onChange:function(t){return a(t.target.files)}}),Object(l.jsx)("label",{className:"button",htmlFor:"fileElem",children:"Select GRP"})]})})}function yt(){var t=d(),e=t.loadingState,i=t.setLoadingState;function s(){e!==n.Loading&&(i(n.Loading),fetch("/grp-explorer/grp/demo.grp").then((function(t){return t.arrayBuffer()})).then((function(t){var e;console.log("demo grp loaded"),e=t,(U=new Z).read(e)})).finally((function(){i(n.Loaded)})))}return Object(l.jsxs)("div",{className:"header",children:[Object(l.jsx)(xt,{}),Object(l.jsx)("div",{className:"loadzone",onClick:function(){return s()},children:Object(l.jsx)("div",{children:"Or load the demo.grp by clicking here"})})]})}var bt=function(t){var e=t.ext,i=Object(s.useState)(!1),n=Object(h.a)(i,2),a=n[0],r=n[1],o=f().setFile,c=B().getFiles(e);return Object(l.jsxs)("div",{className:"section",children:[Object(l.jsxs)("div",{className:"sectionHeader",onClick:function(){r(!a)},children:[e," (",c.length,")"]}),Object(l.jsx)("div",{className:a?"open":"close",children:c.map((function(t,i){return Object(l.jsx)("div",{className:"file",onClick:function(){o({name:t.name,ext:e})},children:t.name},i)}))})]})};function wt(){var t=d().loadingState;return t===n.Loaded?(console.log("RENDER LOADED"),Object(l.jsxs)("div",{className:"sidebar",children:[Object(l.jsx)(bt,{ext:"art"}),Object(l.jsx)(bt,{ext:"bin"}),Object(l.jsx)(bt,{ext:"con"}),Object(l.jsx)(bt,{ext:"map"}),Object(l.jsx)(bt,{ext:"dat"}),Object(l.jsx)(bt,{ext:"mid"}),Object(l.jsx)(bt,{ext:"voc"})]})):t===n.Loading?Object(l.jsx)("div",{className:"sidebar",children:"Loading files.."}):Object(l.jsx)("div",{className:"sidebar"})}function mt(){return Object(l.jsx)("div",{className:"app",children:Object(l.jsx)(u,{children:Object(l.jsxs)(p,{children:[Object(l.jsx)(yt,{}),Object(l.jsx)(wt,{}),Object(l.jsx)(gt,{})]})})})}var jt=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,39)).then((function(e){var i=e.getCLS,n=e.getFID,s=e.getFCP,a=e.getLCP,r=e.getTTFB;i(t),n(t),s(t),a(t),r(t)}))};o.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(mt,{})}),document.getElementById("root")),jt()}},[[38,1,2]]]);
//# sourceMappingURL=main.70974089.chunk.js.map